# -*- coding: utf-8 -*-
"""QRBT_Github.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1fTSDm77wW_F5anKDYYvjKi8L8JkOTCJx
"""

import json
from pathlib import Path

import matplotlib.pyplot as plt
import numpy as np

RESULTS_DIR = Path("results")
ALGORITHMS = ["QAOA", "QAOA_RL", "QSVT", "QPSO", "AQO", "QRBT"]


def load_metric(metric_key):
    """
    Returns:
        levels: sorted list [1..5]
        algo_to_values: dict[algo] -> list of metric values per level
    """
    levels = sorted({1, 2, 3, 4, 5})
    algo_to_values = {}

    for algo in ALGORITHMS:
        fpath = RESULTS_DIR / f"{algo.lower()}_results.json"
        if not fpath.exists():
            continue
        with open(fpath, "r") as f:
            data = json.load(f)

        values = []
        for lvl in levels:
            rec = data.get(str(lvl)) or data.get(lvl)
            if rec is None:
                values.append(np.nan)
            else:
                values.append(rec.get(metric_key, np.nan))
        algo_to_values[algo] = values

    return levels, algo_to_values


def plot_metric(metric_key, ylabel, title, filename):
    levels, algo_to_values = load_metric(metric_key)

    plt.figure()
    for algo, vals in algo_to_values.items():
        plt.plot(levels, vals, marker="o", label=algo)

    plt.xlabel("Workload Level")
    plt.ylabel(ylabel)
    plt.title(title)
    plt.xticks(levels)
    plt.legend()
    plt.grid(True, linestyle="--", alpha=0.5)
    plt.tight_layout()
    plt.savefig(RESULTS_DIR / filename, dpi=300)
    plt.close()


def main():
    RESULTS_DIR.mkdir(exist_ok=True, parents=True)

    plot_metric(
        "latency_reduction_pct",
        "Latency Reduction (%)",
        "Transaction Processing Latency Reduction vs Workload",
        "latency_reduction.png",
    )

    plot_metric(
        "security_pct",
        "Cryptographic Security (%)",
        "Cryptographic Security Under Quantum Attacks",
        "security_quantum.png",
    )

    plot_metric(
        "scalability_pct",
        "Scalability (TPS %)",
        "Blockchain Scalability vs Workload",
        "scalability.png",
    )

    plot_metric(
        "energy_kwh",
        "Energy (kWh)",
        "Energy-Efficient Consensus vs Workload",
        "energy.png",
    )

    plot_metric(
        "convergence_score_pct",
        "RL Convergence Rate (%)",
        "RL Convergence Rate vs Workload",
        "rl_convergence.png",
    )

    print("Plots saved in:", RESULTS_DIR)


if __name__ == "__main__":
    main()